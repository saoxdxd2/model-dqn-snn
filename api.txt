dab2e42da43bc44934cb07d7973984cad6a4407a


import shutil
from pathlib import Path
import os

# Zip the local cache
local_cache = Path("datasets/vision_unified/text_cache")
drive_base = Path("/content/drive/MyDrive/model_checkpoints")

if local_cache.exists():
    print("üì¶ Zipping cache...")
    
    # Create Drive directory
    drive_base.mkdir(parents=True, exist_ok=True)
    
    # Zip the cache (much faster than copying individual files)
    zip_file = drive_base / "text_cache_backup"
    shutil.make_archive(str(zip_file), 'zip', str(local_cache))
    
    zip_size = os.path.getsize(str(zip_file) + ".zip") / (1024**3)
    print(f"‚úÖ Zipped to Drive: text_cache_backup.zip ({zip_size:.2f}GB)")
    print(f"   Location: {zip_file}.zip")
    print(f"   Will sync to E:\\ automatically")
else:
    print("‚ö†Ô∏è No local cache found")




    # === Complete Colab Setup with Image Cache ===
import os, shutil
from pathlib import Path

# 1. Mount Drive
try:
    from google.colab import drive
    drive.mount('/content/drive', force_remount=False)
    os.makedirs('/content/drive/MyDrive/model-dqn-snn', exist_ok=True)
    print("‚úÖ Drive mounted")
except: 
    print("‚ö†Ô∏è  Drive mount failed")

# 2. Update repo
%cd /content
if os.path.exists('model-dqn-snn'):
    %cd model-dqn-snn
    !git reset --hard HEAD
    !git pull origin main
    print("‚úÖ Repo updated")
else:
    !git clone https://github.com/saoxdxd2/model-dqn-snn.git
    %cd model-dqn-snn
    print("‚úÖ Repo cloned")

# 3. Restore encoding checkpoint from Drive
drive_ckpt = Path('/content/drive/MyDrive/model-dqn-snn/encoding_checkpoint.pt')
local_ckpt = Path('datasets/vision_unified/encoding_checkpoint.pt')
if drive_ckpt.exists():
    local_ckpt.parent.mkdir(parents=True, exist_ok=True)
    shutil.copy2(drive_ckpt, local_ckpt)
    try:
        import torch
        ckpt = torch.load(local_ckpt, map_location='cpu')
        progress = ckpt['batch_count'] / ckpt['total_batches'] * 100
        print(f"‚úÖ Restored checkpoint: {progress:.1f}% complete")
    except:
        print("‚úÖ Checkpoint restored")
else:
    print("‚ÑπÔ∏è  Starting fresh")

# 4. Restore image cache from Drive (critical for speed!)
drive_cache = Path('/content/drive/MyDrive/model-dqn-snn/text_cache')
local_cache = Path('datasets/vision_unified/text_cache')
if drive_cache.exists():
    print("üì¶ Restoring image cache from Drive...")
    shutil.copytree(drive_cache, local_cache, dirs_exist_ok=True)
    print("‚úÖ Cache restored (encoding will be 10x faster)")
else:
    print("‚ÑπÔ∏è  No cache yet (first run will populate it)")

# 5. Install dependencies
!pip install -q --no-cache-dir -r requirements.txt

# 6. Start training
print("\n" + "="*70)
print("üöÄ Starting training with cached pipeline")
print("   First run: ~60 min (populate cache + encode)")
print("   Later runs: ~45 min (instant cache load)")
print("   Saves every 2000 batches to Drive")
print("="*70 + "\n")
!python train.py